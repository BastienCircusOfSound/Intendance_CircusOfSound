<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Bar - CircusOfSound</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Écran de connexion */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .login-form {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 400px;
        }

        .login-form h1 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary);
        }

        /* Application principale */
        .app-container {
            display: none;
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .nav-tab {
            padding: 10px 20px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-tab.active {
            background: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Styles des formulaires */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        /* Boutons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        /* Tableaux */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: var(--primary);
            color: white;
        }

        /* Messages d'erreur */
        .error {
            color: var(--danger);
            background: #ffeaea;
            padding: 0.5rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }

        /* Badges */
        .badge {
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: white;
        }

        .badge-danger {
            background: var(--danger);
            color: white;
        }

        .badge-primary {
            background: var(--secondary);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .login-form {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Écran de connexion -->
    <div id="login-container" class="login-container">
        <div class="login-form">
            <h1>CircusOfSound - Gestion Bar</h1>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Nom d'utilisateur:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Mot de passe:</label>
                    <input type="password" id="password" required>
                </div>
                <div class="form-group">
                    <label for="user-role">Rôle:</label>
                    <select id="user-role" required>
                        <option value="">Sélectionnez un rôle</option>
                        <option value="admin">Administrateur</option>
                        <option value="bar-principal">Bar Principal</option>
                        <option value="bar-terrasse">Bar Terrasse</option>
                        <option value="bar-vip">Bar VIP</option>
                        <option value="magasin">Magasin</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Se connecter</button>
                <div id="login-error" class="error">Veuillez remplir tous les champs</div>
            </form>
        </div>
    </div>

    <!-- Application principale -->
    <div id="app-container" class="app-container">
        <div class="header">
            <div class="container">
                <h1>Gestion Bar - CircusOfSound</h1>
                <p>Utilisateur: <span id="current-user"></span> | Rôle: <span id="current-role"></span></p>
                <button class="btn btn-danger" onclick="logout()" style="float: right;">Déconnexion</button>
            </div>
        </div>

        <div class="container">
            <!-- Navigation par onglets -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('commandes')">Commandes</button>
                <button class="nav-tab" onclick="showTab('livraisons')">Livraisons</button>
                <button class="nav-tab" onclick="showTab('retours')">Retours</button>
                <button class="nav-tab" onclick="showTab('stock')">Stock</button>
                <button class="nav-tab" onclick="showTab('rapports')">Rapports</button>
            </div>

            <!-- Onglet Commandes -->
            <div id="commandes-tab" class="tab-content active">
                <h2>Commandes</h2>
                
                <!-- Formulaire nouvelle commande -->
                <div style="background: white; padding: 1.5rem; border-radius: 5px; margin-bottom: 2rem;">
                    <h3>Nouvelle Commande</h3>
                    <form id="commande-form">
                        <div class="form-group">
                            <label>Produit:</label>
                            <select id="produit-select">
                                <option value="">Sélectionnez un produit</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Quantité:</label>
                            <input type="number" id="quantite-input" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label>Raison:</label>
                            <select id="raison-select">
                                <option value="non-ouvert">Non ouvert</option>
                                <option value="defectueux">Défectueux</option>
                                <option value="perime">Périmé</option>
                                <option value="erreur">Erreur de commande</option>
                            </select>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="ajouterProduitCommande()">Ajouter Produit</button>
                    </form>

                    <div id="produits-commande" style="margin-top: 1rem;"></div>
                    
                    <div class="form-group" style="margin-top: 1rem;">
                        <label>Notes:</label>
                        <textarea id="notes-commande" rows="3"></textarea>
                    </div>
                    
                    <button class="btn btn-success" onclick="soumettre Commande()">Soumettre Commande</button>
                </div>

                <!-- Liste des commandes -->
                <div style="background: white; padding: 1.5rem; border-radius: 5px;">
                    <h3>Liste des Commandes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date</th>
                                <th>Bar</th>
                                <th>Produits</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="commandes-tbody">
                            <tr>
                                <td colspan="6" class="text-center">Aucune commande</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Onglet Stock -->
            <div id="stock-tab" class="tab-content">
                <h2>Gestion des Stocks</h2>
                
                <div style="background: white; padding: 1.5rem; border-radius: 5px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Produit</th>
                                <th>Catégorie</th>
                                <th>Unité</th>
                                <th>Réserve</th>
                                <th>Bar Principal</th>
                                <th>Bar Terrasse</th>
                                <th>Bar VIP</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="stock-tbody">
                            <tr>
                                <td colspan="8" class="text-center">Chargement des stocks...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Autres onglets (simplifié pour l'exemple) -->
            <div id="livraisons-tab" class="tab-content">
                <h2>Livraisons</h2>
                <p>Fonctionnalité des livraisons à venir...</p>
            </div>

            <div id="retours-tab" class="tab-content">
                <h2>Retours</h2>
                <p>Fonctionnalité des retours à venir...</p>
            </div>

            <div id="rapports-tab" class="tab-content">
                <h2>Rapports</h2>
                <p>Fonctionnalité des rapports à venir...</p>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentUser = null;
        let produits = [];
        let commandes = [];
        let livraisons = [];
        let retours = [];
        let produitsCommande = [];

        // Données d'exemple pour les produits
        const produitsExemple = [
            { id: 'P001', Nom: 'Bière Blonde', Catégorie: 'Bière', Unité: 'Bouteille', Stock_Réserve: 100, Stock_BarOne: 20, Stock_BarTwo: 15, Stock_BarThree: 10 },
            { id: 'P002', Nom: 'Vodka', Catégorie: 'Spiritueux', Unité: 'Bouteille', Stock_Réserve: 50, Stock_BarOne: 5, Stock_BarTwo: 3, Stock_BarThree: 2 },
            { id: 'P003', Nom: 'Coca-Cola', Catégorie: 'Soft', Unité: 'Canette', Stock_Réserve: 200, Stock_BarOne: 50, Stock_BarTwo: 40, Stock_BarThree: 30 },
            { id: 'P004', Nom: 'Whisky', Catégorie: 'Spiritueux', Unité: 'Bouteille', Stock_Réserve: 30, Stock_BarOne: 3, Stock_BarTwo: 2, Stock_BarThree: 5 }
        ];

        // Fonctions utilitaires
        function getRoleName(roleCode) {
            const roles = {
                'admin': 'Administrateur',
                'bar-principal': 'Bar Principal',
                'bar-terrasse': 'Bar Terrasse',
                'bar-vip': 'Bar VIP',
                'magasin': 'Magasin'
            };
            return roles[roleCode] || roleCode;
        }

        function getStatusName(statusCode) {
            const statuts = {
                'en-attente': 'En attente',
                'en-cours': 'En cours',
                'livree': 'Livrée',
                'annulee': 'Annulée',
                'confirme': 'Confirmé'
            };
            return statuts[statusCode] || statusCode;
        }

        function getCategoryName(categoryCode) {
            const categories = {
                'Bière': 'Bière',
                'Spiritueux': 'Spiritueux',
                'Soft': 'Boissons sans alcool',
                'Vin': 'Vin'
            };
            return categories[categoryCode] || categoryCode;
        }

        // Fonctions d'authentification
        function checkAuth() {
            const savedUser = localStorage.getItem('gestionBarUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
                initializeData();
            }
        }

        function showApp() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            document.getElementById('current-user').textContent = currentUser.username;
            document.getElementById('current-role').textContent = getRoleName(currentUser.role);
        }

        function logout() {
            localStorage.removeItem('gestionBarUser');
            currentUser = null;
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('login-form').reset();
        }

        // Navigation par onglets
        function showTab(tabName) {
            // Masquer tous les onglets
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Désactiver tous les boutons de navigation
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));

            // Afficher l'onglet sélectionné
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Initialisation des données
        function initializeData() {
            produits = [...produitsExemple];
            updateProduitSelect();
            updateStockTable();
        }

        function updateProduitSelect() {
            const select = document.getElementById('produit-select');
            select.innerHTML = '<option value="">Sélectionnez un produit</option>';
            
            produits.forEach(produit => {
                const option = document.createElement('option');
                option.value = produit.id;
                option.textContent = `${produit.Nom} (${produit.Unité})`;
                select.appendChild(option);
            });
        }

        function updateStockTable() {
            const tbody = document.getElementById('stock-tbody');
            
            if (produits.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center">Aucun produit</td></tr>';
                return;
            }

            let html = '';
            produits.forEach(produit => {
                const total = produit.Stock_Réserve + produit.Stock_BarOne + produit.Stock_BarTwo + produit.Stock_BarThree;
                html += `
                <tr>
                    <td>${produit.Nom}</td>
                    <td>${getCategoryName(produit.Catégorie)}</td>
                    <td>${produit.Unité}</td>
                    <td>${produit.Stock_Réserve}</td>
                    <td>${produit.Stock_BarOne}</td>
                    <td>${produit.Stock_BarTwo}</td>
                    <td>${produit.Stock_BarThree}</td>
                    <td><strong>${total}</strong></td>
                </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Gestion des commandes
        function ajouterProduitCommande() {
            const produitId = document.getElementById('produit-select').value;
            const quantite = parseInt(document.getElementById('quantite-input').value);
            const raison = document.getElementById('raison-select').value;

            if (!produitId || quantite <= 0) {
                alert('Veuillez sélectionner un produit et une quantité valide.');
                return;
            }

            const produit = produits.find(p => p.id === produitId);
            if (!produit) {
                alert('Produit non trouvé.');
                return;
            }

            // Vérifier si le produit est déjà dans la commande
            const existingIndex = produitsCommande.findIndex(p => p.produit === produitId);
            if (existingIndex !== -1) {
                produitsCommande[existingIndex].quantite += quantite;
            } else {
                produitsCommande.push({
                    produit: produitId,
                    quantite: quantite,
                    raison: raison
                });
            }

            updateProduitsCommandeDisplay();
            
            // Réinitialiser le formulaire
            document.getElementById('produit-select').value = '';
            document.getElementById('quantite-input').value = '1';
            document.getElementById('raison-select').value = 'non-ouvert';
        }

        function updateProduitsCommandeDisplay() {
            const container = document.getElementById('produits-commande');
            
            if (produitsCommande.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<h4>Produits dans la commande:</h4><ul>';
            produitsCommande.forEach((item, index) => {
                const produit = produits.find(p => p.id === item.produit);
                if (produit) {
                    html += `
                    <li>
                        ${produit.Nom} - Quantité: ${item.quantite} - Raison: ${item.raison}
                        <button class="btn btn-danger" style="margin-left: 10px;" onclick="retirerProduitCommande(${index})">Retirer</button>
                    </li>
                    `;
                }
            });
            html += '</ul>';

            container.innerHTML = html;
        }

        function retirerProduitCommande(index) {
            produitsCommande.splice(index, 1);
            updateProduitsCommandeDisplay();
        }

        function soumettreCommande() {
            if (produitsCommande.length === 0) {
                alert('Veuillez ajouter au moins un produit à votre commande.');
                return;
            }

            const notes = document.getElementById('notes-commande').value;
            
            const commande = {
                id: 'CMD-' + Date.now(),
                date: new Date().toISOString(),
                bar: currentUser.role,
                utilisateur: currentUser.username,
                produits: [...produitsCommande],
                notes: notes,
                statut: 'en-attente'
            };

            commandes.push(commande);
            
            // Réinitialiser le formulaire
            produitsCommande = [];
            updateProduitsCommandeDisplay();
            document.getElementById('notes-commande').value = '';
            
            updateCommandesTable();
            
            alert(`Commande ${commande.id} soumise avec succès!`);
        }

        function updateCommandesTable() {
            const tbody = document.getElementById('commandes-tbody');
            
            if (commandes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">Aucune commande</td></tr>';
                return;
            }

            let html = '';
            commandes.forEach(commande => {
                const date = new Date(commande.date).toLocaleString('fr-FR');
                const barName = getRoleName(commande.bar);
                
                let produitsList = '';
                commande.produits.forEach(p => {
                    const produit = produits.find(prod => prod.id === p.produit);
                    if (produit) {
                        produitsList += `${produit.Nom} (x${p.quantite}), `;
                    }
                });
                produitsList = produitsList.slice(0, -2);
                
                let statutClass = '';
                switch(commande.statut) {
                    case 'en-attente':
                        statutClass = 'badge-warning';
                        break;
                    case 'en-cours':
                        statutClass = 'badge-primary';
                        break;
                    case 'livree':
                        statutClass = 'badge-success';
                        break;
                    case 'annulee':
                        statutClass = 'badge-danger';
                        break;
                }

                html += `
                <tr>
                    <td>${commande.id}</td>
                    <td>${date}</td>
                    <td>${barName} (${commande.utilisateur})</td>
                    <td>${produitsList}</td>
                    <td><span class="badge ${statutClass}">${getStatusName(commande.statut)}</span></td>
                    <td>
                        <button class="btn btn-primary" onclick="voirCommande('${commande.id}')">Voir</button>
                    </td>
                </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        function voirCommande(commandeId) {
            const commande = commandes.find(c => c.id === commandeId);
            if (!commande) return;
            
            let produitsHtml = '';
            commande.produits.forEach(p => {
                const produit = produits.find(prod => prod.id === p.produit);
                if (produit) {
                    produitsHtml += `• ${produit.Nom} (${produit.Unité}) - Quantité: ${p.quantite}\n`;
                }
            });
            
            const date = new Date(commande.date).toLocaleString('fr-FR');
            const message = `Détails de la commande ${commande.id}

Date: ${date}
Bar: ${getRoleName(commande.bar)}
Utilisateur: ${commande.utilisateur}
Statut: ${getStatusName(commande.statut)}

Produits:
${produitsHtml}
Notes: ${commande.notes || 'Aucune'}`;
            
            alert(message);
        }

        // Événements
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            
            document.getElementById('login-form').addEventListener('submit', function(event) {
                event.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const role = document.getElementById('user-role').value;
                
                if (username && password && role) {
                    currentUser = {
                        username: username,
                        role: role,
                        isAdmin: role === 'admin'
                    };
                    
                    localStorage.setItem('gestionBarUser', JSON.stringify(currentUser));
                    showApp();
                    initializeData();
                } else {
                    document.getElementById('login-error').style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
